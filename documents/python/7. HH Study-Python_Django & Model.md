# 20190604 - HH Study - 장고 모델





## Full Managing

1. models.py 작성
2. makemigrations : 설계도 작성
3. migrate : DB 생성



DB - ORM

DB에 넣기 위한 모델을 만든다. SQL 문을 우리가 직접 건들지 않는다.

```
# id = models.AutoField(primary_key=True)
```

는 테이블 생성시 자동으로 생성된다.



CharField : String 의 길이 제한

TextField : 따로 길이 제한이 없음

시간 설정 : user_tz 는 model 에서도 사용자가 지정한 time_zone 을 적용시키기 위해 False로 설정한다.



테이블 생성 후 장고에 알려주어야 한다. 그럼 initial.py 가 생성된다.

` python manage.py makemigrations `

model 을 수정할 때마다 코드를 실행한다?



` python manage.py sqlmigrate boards 0002 ` 

SQL 문으로 번역된 것을 확인할 수 있다.



`python manage.py migrate` SQL에 넣기!

첫 마이그레이션은 무조건 위와 같이 한다. 



sqllite 다운로드

;C:\sqlite 계정의 환경변수에서 설정

그리고 git.bash 에서 아래 코드 실행

` winpty sqlite3`

.exit

이후 파이참 껐다가 다시 실행한다. 이후 sqlite3 하면 똑같이 실행되어야 한다.



sqlite3 db.sqlite3

.tables

.schema boards_board





















```
>> python manage.py shell
>> from boards.models import Board
>> Board.objects.all() (== 전체 조회)
```

board = Board() : 인스턴스 생성

board.save() 해야 객체에 데이터가 입력이 된다.



데이터 넣는 3가지 방법

```
board = Board()
board.title = 'first'
```

```
board = Board(title='second')
```

```
Board.objects.create(title='third')
```



board.full_clean() : 유효성 검사



```
def __str__(self):
    return f'{self.id}글 - {self.title}: {self.content}'
```

위는 실제 컬럼 속성에 영향을 끼치지 않으므로 수정을 하더라도 마이그레이션을 할 필요가 없다.



>>> from boards.models import Board
>>> Board.objects.all()
>>> <QuerySet [<Board: 1글 - first: django!>, <Board: 2글 - second: django!!>, <Board: 3글 - thrid: django!!!>, <Board: 4글 - fourth: django!!!!>]>



Board.objects.filter() 는 여러 셋을 가져올 수 있다. 이중 첫번째를 가져오고 싶으면

>>> boards = Board.objects.filter(title='first')
>>> boards
>>> <QuerySet [<Board: 1글 - first: django!>]>
>>> boards = Board.objects.filter(title='first').first()
>>> boards
>>> <Board: 1글 - first: django!>



>>> board = Board.objects.get(id=1)
>>> board
>>> <Board: 1글 - first: django!>



```
>>> boards = Board.objects.filter(content__endswith='!')
>>> boards
<QuerySet [<Board: 1글 - first: django!>, <Board: 2글 - second: django!!>, <Board: 3글 - thrid: django!!!>, <Board: 4글 - fourth: django!!!!>]>

```



```
>>> boards = Board.objects.order_by('title')
>>> boards
<QuerySet [<Board: 1글 - first: django!>, <Board: 4글 - fourth: django!!!!>, <Board: 2글 - second: django!!>, <Board: 3글 - thrid: django!!!>]>

```

```
>>> boards = Board.objects.order_by('-title')
>>> boards
<QuerySet [<Board: 3글 - thrid: django!!!>, <Board: 2글 - second: django!!>, <Board: 4글 - fourth: django!!!!>, <Board: 1글 - first: django!>]>
```

UPDATE



DELETE



## Shell 확장 프로그램

` $ python manage.py createsuperuser `



```
from django.contrib import admin
from .models import Board

# Register your models here.
admin.site.register(Board)
```

` $ pip install django-extensions `

```
INSTALLED_APPS = [
    'boards.apps.BoardsConfig',
    'django_extensions',
    'django.contrib.admin',
```



Error

` PEP 8 : missing  whitespace around operator `

위와 같은 메시지는 파이썬이 추구하는 코드 스타일을 어겼다는 뜻이다. 로직 상은 문제가 없다. 



보통 데이터 할당은 공백을 준다.

` title = ` 1 

나머지는 붙인다.

` <h1>test</h1>`

` <h1>   test   </h1> ` 가 아니다.

` test(title=title) `

` test(title   =   title) ` 이 아니다.





## Reference

<https://django-extensions.readthedocs.io/en/latest/> : django 확장프로그램